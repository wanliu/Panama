<% active_section :cart %>
<div class='row-fluid'>
	<div class='span12'>
		<div class="page-header">
		  <h1>购物车 <small>你挑选的宝贝都在这里吗?</small></h1>
		</div>
	</div>
</div>
<div class="row-fluid">
	<div class="span8 cart-container">
		<section class="widget">
			<div class="body">
				<table class="table table-striped table-images">
					<thead>
						<tr>
							<th>图片</th>
							<th>名称</th>
							<th>卖家</th>
							<th>数量</th>
							<th>小计</th>
							<th> </th>
						</tr>
					</thead>
					<tbody>
					<% @items.each do |item| %>
						<tr>
							<td class='product-item product-item-<%=item.id %>'  data-value-id="<%=item.id %>">
							<%= link_to '#' do %>
								<%= image_tag item.header, :class => "img-polaroid" %>
							<% end %>
							<td>
								<%= item.title %>
							</td>
							<td>
								<%= link_to '#' do %>
									<%= image_tag item.product.shop.try(:icon_url), :class => "img-polaroid img-seller" %>
								<% end %>
								<h5><%= item.product.shop.name %></h5>
							</td>
							<td>
								<%= simple_form_for item,:url => "" do |f| %>
									<%= f.input :amount, 
										:label => false,
										:value => item.amount, 
										:as => :spinner,
										input_html: {
											:panel_class =>"amount_#{item.id}"} %>
								  <script type="text/javascript">
									  new ChangeNumber({
										el : $(".product-item-<%=item.id %>"),
										login : "<%=current_user.login %>"})
								  </script>
								<% end %>
							</td>
							<td>
								<price><%= item.price %></price>
							</td>
							<td>
								<%= button_to "不想要了",
									move_out_cart_person_cart_path(@people.login, item.id),
									:method => :post,
									:remote => true,
									:class => "btn btn-mini" %>
							</td>
						</tr>
					<% end %>
					<%= paginate @items %>
					</tbody>
				</table>
				<div class='cart-total'>
					<div class='quantity'>
						<span class='cart-quantity-total'><%= @quantity_total %></span>件商品
					</div>
					<div class='price'>
						总计<span class='cart-price-total'><%= @price_total %></span>元
					</div>
				</div>
				<div class="form-actions">
					<% if can? :batch_create, OrderTransaction %>
						<%= form_tag batch_create_person_transactions_path(@people.login), :method => :post do %>
							<input type='submit' value='生成订单' class='btn btn-primary btn-large' />
						<% end %>
					<%end%>

					<% if can? :destroy, Cart %>
						<%= button_to "清空列表",clear_cart_list_path ,:class => "btn btn-large" %>
					<% end %> 
				</div>
			</div>
		</section>
	</div>
</div>