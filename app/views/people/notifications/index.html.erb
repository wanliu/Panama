<% active_section :notification %>

<div class='row-fluid'>
  <div class="span7 widget">
    <div class='row-fluid'>
<!--
      <ul class="nav nav-tabs pull-right" id="notification-category">
        <li class="active">

          <a data-toggle="tab" href="#task-tab" class='activity'><i class='icon-tasks' ></i>活动</a>

        </li>

        <li class="">
          <a data-toggle="tab" href="#groups-tab" class='group'><i class='icon-group' ></i>好友/商圈</a>
        </li>

        <li class="">
          <a data-toggle="tab" href="#transcation-tab"><i class='icon-shopping-cart' ></i>交易</a>
        </li>

        <li class="">
          <a data-toggle="tab" href="#other-tab"><i class='icon-asterisk' ></i>综合</a>
        </li>
      </ul> -->
      <h3 class="page-title">
        通知的清单
      </h3>

  </div>

  <div class="tab-content">
<!--     <div class="tab-pane active" id="task-tab">
      <%= render "activities" %>
    </div>
    <div class="tab-pane" id="groups-tab">
      <%= render "groups" %>
    </div>
    <div class="tab-pane" id="transcation-tab">
      <%= render "transcation" %>
    </div>
    <div class="tab-pane" id="other-tab">
      <%= render "other" %>
    </div> -->
    <div class='row-fluid notification_panel'>
      <ul>
        <% @notifications.each do |n| %>
          <li class='notification_one' data-id="<%= n.id %>">
            <ul class='notification-actions'>
              <li class='read'>
                <%= checked_button(n) %>
              </li>
              <li class='avatar'>
                <%= image_tag n.additional[:avatar], :class => ['avatar', 'avatar-icon', 'pull-right'] %>
              </li>
              <li class='age'>
                <%= distance_of_time_in_words n.created_at, Time.now %>
              </li>
            </ul>
<!--               <p>
                <span class="label <%= n.read ? "" : "label-important" %>" style='position: absolute;top: 0px;right: 0px;'>
                  <%= n.read ? "已读取" : "未读取" %>
                </span>
                <span>
                  <a href="<%=person_notification_path(current_user.login, n.id) %>/enter">
                    查看&nbsp;&nbsp;
                  </a>
                  <a href="javascript:void(0)" class="mark_read" data-value-id='<%=n.id %>'>标为已读</a>
                </span>
              </p> -->
            <h5 class='content'><%=raw n.content %></h5>
          </li>
        <% end %>
      </ul>
      <% unless params[:all] == "1" %>
        <div class='batch-btns'>
          <a href="<%= person_notifications_path(current_user.login) %>?all=1">查看所有提醒</a>
        </div>
      <% end %>
    </div>
  </div>
</div>

<script type="text/javascript">
  $(function(){
    id = ~~paramsFromUrl().id;
    if (id > 0) {
      $target = $('.notification_panel').find('[data-id="'+id+'"]');
      $target.css('background-color', 'rgb(29, 107, 126)');
    }
    
    $(".mark_read").bind("click", function(){
      target = $(event.target),
      current_user="<%= current_user.login %>",
      notification=target.attr("data-value-id"),
      $.ajax({
        type: "post",
        url: "/people/"+current_user+"/notifications/"+notification+"/mark_as_read",
        success: function(){
          target.parents("li").remove()
        }
      })
    })
  })
</script>