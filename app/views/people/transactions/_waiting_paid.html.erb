<!-- 等待付款 -->
<div class="container-fluid">
<% payment_service_for 'payment code', 'hysios',
                            :service => :alipay,
                            :html => { :id => 'payment-form', :method => :get } do |service| %>
  <% service.total_fee 0.02 %>
  <% service.seller :email => 'hysios@msn.com' %>
  <% service.notify_url notify_person_transaction_url(@people, transaction) %>
  <% service.return_url done_person_transaction_url(@people, transaction) %>
  <% service.show_url person_transaction_url(@people, transaction) %>
  <% service.body 'payment body' %>
  <% service.charset "utf-8" %>
  <% service.service ActiveMerchant::Billing::Integrations::Alipay::Helper::CREATE_DIRECT_PAY_BY_USER %>
  <% service.payment_type 1 %>
  <% service.subject 'payment subject' %>
  <% service.sign %>
<% end %>
<%#= button_to_function "Submit", "document.getElementById('payment-form').firstChild.remove();document.getElementById('payment-form').submit()", :class=> 'btn' %>
<div class="info">
  <div class="row-fluid">
    <table class="table table-striped table-images">
      <thead>
        <tr>
          <th>图片</th>
          <th>收货地址</th>
          <th>配送方式</th>
          <th>合计(含运费)</th>
        </tr>
      </thead>
      <tr>
        <td><% transaction.items[0...10].each do |item| %>
        <%= image_tag item.product.photos.icon, :class => "avatar" %>x<%= item.amount.to_i %>
          <% end %></td>
        <td><%= transaction.address.try(:location) %></td>
        <td><%= transaction.delivery_type.try(:name) %></td>
        <td><%= number_to_currency(transaction.stotal) %></td>
      </tr>
    </table>

  </div>
  你的余额：<%= number_to_currency(current_user.money) %>
</div>

  <% if current_user.credits.size > 0 %>
  <hr>
  <div class="row-fluid">
    <%= current_user.credits.each do |card| %>
      <%= content_tag :div, :class => 'bank_card' do %>
        <%= radio_button_tag :bank, card.bank.code %>
        <%= label_tag "bank_#{card.bank.code}" do %>
          <span class="banks bank-<%= bank.code %>"><%= card.bank.name %></span>
        <% end %>
      <% end %>
    <% end %>
  </div>
  <% end %>
  <hr>
  <div class="row-fluid paid_bank">
    <div class="bank-wrapper">

    <% Bank.all.each do |bank| %>
      <%#= link_to '#' do %>
      <%= content_tag :div, :class => 'bank_card' do %>
        <%= radio_button_tag :bank, bank.code %>
        <%= label_tag "bank_#{bank.code}" do %>
          <span class="banks bank-<%= bank.code %>"><%= bank.name %></span>
        <% end %>
      <% end %>
    <% end %>
    </div>
    <div class='clearfix'></div>
    <div class="form-actions">
      <%= link_to "转到银行付款", "#", :method => :post %>
    </div>
  </div>
</div>
<script type="text/javascript">
  new TransactionPayment({
    el: $("#order<%=transaction.id %>"),
    model: {
      total: <%= transaction.total %>,
      money: <%= current_user.money || 0 %>
    }
  })
</script>