<!-- 等待付款 -->
<div class="container-fluid">
<% payment_service_for 'payment code', 'hysios',
                            :service => :alipay,
                            :html => { :id => 'payment-form', :method => :get } do |service| %>
  <% service.total_fee 0.02 %>
  <% service.seller :email => 'hysios@msn.com' %>
  <% service.notify_url notify_person_transaction_url(@people, transaction) %>
  <% service.return_url done_person_transaction_url(@people, transaction) %>
  <% service.show_url person_transaction_url(@people, transaction) %>
  <% service.body 'payment body' %>
  <% service.charset "utf-8" %>
  <% service.service ActiveMerchant::Billing::Integrations::Alipay::Helper::CREATE_DIRECT_PAY_BY_USER %>
  <% service.payment_type 1 %>
  <% service.subject 'payment subject' %>
  <% service.sign %>
<% end %>
<%#= button_to_function "Submit", "document.getElementById('payment-form').firstChild.remove();document.getElementById('payment-form').submit()", :class=> 'btn' %>
  <div class="info">
  <div class="row-fluid">
    <div class="span2">
      <label class="control-label">收货地址：</label>
    </div>
    <div class="span4">
      <%= transaction.address.try(:location) %>
    </div>
    <div class="span2">
      <label class="control-label">邮编：</label>
    </div>
    <div class="span4">
      <small><%= transaction.address.try(:zip_code) %></small>
    </div>
  </div>

  <div class="row-fluid">
    <div class="span2">
      <label class="control-label">配送方式：</label>
    </div>
    <div class="span4">
      <%= transaction.delivery_type.try(:name) %>
    </div>
    <div class="span2">
      <label class="control-label">配送费用：</label>
    </div>
    <div class="span4">
      <%= number_to_currency(transaction.try(:delivery_price)) %>
    </div>
  </div>

  <div class="row-fluid">
    <div class="span2">
      <label class="control-label" for="inputEmail">购买的宝贝：</label>
    </div>
    <div class="span10">
      <% transaction.items[0...10].each do |item| %>
        <%= image_tag item.product.photos.icon %><small>x<%= item.amount.to_i %></small>
      <% end %>
    </div>
  </div>
</div>
  <table class="table table-striped">
    <thead>
    <tr>
      <th colspan=2 class="relative">
        <div class="left-frame"></div>
      </th>
      <th><strong>合计(含运费)：<%= number_to_currency(transaction.stotal) %></strong>
      </th>
      <th><strong>你的余额：<%= number_to_currency(current_user.money) %></strong>
      </th>
      <th class="relative">
        <div class="right-frame"></div>
      </th>
    </tr>
    </thead>
  </table>
  <% if current_user.credits.size > 0 %>
  <hr>
  <div class="row-fluid">
    <%= current_user.credits.each do |card| %>
      <%= content_tag :div, :class => 'bank_card' do %>
        <%= radio_button_tag :bank, card.bank.code %>
        <%= label_tag "bank_#{card.bank.code}" do %>
          <span class="banks bank-<%= bank.code %>"><%= card.bank.name %></span>
        <% end %>
      <% end %>
    <% end %>
  </div>
  <% end %>
  <hr>
  <div class="row-fluid">
    <div class="bank-wrapper">

    <% Bank.all.each do |bank| %>
      <%#= link_to '#' do %>
      <%= content_tag :div, :class => 'bank_card' do %>
        <%= radio_button_tag :bank, bank.code %>
        <%= label_tag "bank_#{bank.code}" do %>
          <span class="banks bank-<%= bank.code %>"><%= bank.name %></span>
        <% end %>
      <% end %>
    <% end %>
    </div>
    <div class='clearfix'></div>
    <div class="form-actions">
      <a href='transactions/1/recharge?trade_income[bank_id]=1&trade_income[money]=100' class="btn btn-primary">转到银行付款</a>
    </div>
  </div>
</div>
<script type="text/javascript">
  require(["jquery", "people/transaction_payment"], function($, TransactionPayment){
      new TransactionPayment({
        el: $("#order<%=transaction.id %>"),
        model: {
          total: <%=transaction.total %>,
          money: <%=current_user.money %>
        }
      })
  })
</script>