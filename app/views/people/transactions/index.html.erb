<% active_section :transaction %>

<div class='row-fluid'>
  <h4 class="page-title">
    担保交易订单
    <small>交易的清单</small>
  </h4>
</div>
<div class='row-fluid transaction-list'>
  <div class='span12 left'>
    <div class='people-groups'>
<!--       <% transaction = @transactions.first %>
      <%#= render :partial => "transaction",
                 :object => transaction,
                 :locals => {
                   :state => transaction.state,
                   :people => @people} %>

      <% @transactions.group_by { |tran| tran.seller }.each do |seller, trans| %>
        <div class='seller'>
          <%= shop_image_link seller %>
          <div class='shop_info'>
            <div class='name'>
              <%= shop_link seller %>
            </div>
            <div class='row-fluid products'>
              <div class='span7'>
                <% t.items.each do |item| %>
                <%=render_funcat "product_item", :item => item %>
                <% end %>
              </div>
              <div class='span2'>
                <div>
                  <%=number_to_currency t.stotal %>
                </div>
                <div class='delivery_price'>
                  (含<%=t.delivery_price || 0 %>运费)
                </div>
              </div>
              <div class='span2 state_title'>
                <%=t.buyer_state_title %>
              </div>
              <div class='span1'>
                <% if t.close_state? %>
                <a href='javascript:void(0)' class='btn_delete'>
                  删除
                </a>
                <% end %>
              </div>
            <div class='address'>
              <%= seller.address.location %>
            </div>
          </div>
          <%#= image_tag seller.photos.icon, :class=> 'avatar avatar-icon' %>
          <%#= seller.name %>
        </div>
        <div class='orders'>
          <%= render :partial => "order_mini_row", :collection => @transactions, :as => :row %>
        </div>
      <% end %> -->
    </div>


    <div class='threeD-viewport'>
       <div class='orders'>
        <%= render :partial => "order_mini_row", :collection => @transactions * 20, :as => :row %>
      </div>
    </div>

    <div class='boxes'>
      <div class='upbox'></div>
      <div class='currentbox'></div>
      <div class='downbox'></div>
    </div>
     <%= paginate @transactions %>
  </div>
  <div class='order-detail'>

  </div>

<!--   <div class='span5'>
    <div class='people-chat' data-spy="affix" data-offset-top="80">

    </div>
  </div> -->

</div>
<script type='text/javascript'>
  $(function(){

    // var orders = new OrderTransactions({
    //   el: $(".transaction-list"),
    //   remote_url: "<%= person_transactions_path(@people) %>"
    // })

    var view = new TransactionTwoColumnsViewport({
      el: $(".transaction-list"),
      child: ".order_item",
      secondContainer: ".order-detail",
      remote_url: "<%= person_transactions_path(@people) %>",
      faye_url: '<%= faye_server_uri %>',
      token: '<%= token %>'
    });
  })
</script>