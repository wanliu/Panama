<% active_section :transaction %>

<div class='row-fluid'>
  <h4 class="page-title">
    交易订单
    <small>交易的清单</small>
  </h4>
</div>
<div class='row-fluid transaction-list'>
  <div class='widget span8'>
    <div class='row-fluid'>
      <div class='span7'>
        <div class='span7'>
          宝贝
        </div>
        <div class='span3'>
          单价
        </div>
        <div class='span2'>
          数量
        </div>
      </div>
     <div class='span2'>
        合计
      </div>
      <div class='span2'>
        状态
      </div>
      <div class='span1'>
        操作
      </div>
    </div>
    <% @transactions.each do |t| %>
    <table class='table table-striped'>
      <tbody>
        <tr>
          <td>
            <div class='row-fluid head'>
              <div class='span3'>
                订单编号: <%=t.number %>
              </div>
              <div class='span4'>
                成交时间 <%=t.created_at.strftime("%Y-%m-%d %H:%M:%S") %>
              </div>
              <div class='span2'>
                <%= link_to t.seller.name, shop_path(t.seller)  %>
              </div>
            </div>
            <div class='row-fluid products'>
              <div class='span7'>
                <% t.items.each do |item| %>
                <div class='row-fluid'>
                  <div class='span3'>
                    <img src="<%=item.photos.header %>" alt="<%=item.title %>" />
                  </div>
                  <div class='span4'>
                    <%=item.title %>
                  </div>
                  <div class='span3'>
                    <%=number_to_currency(item.price) %>
                  </div>
                  <div class='span2'>
                    <%=item.amount %>
                  </div>
                </div>
                <% end %>
              </div>
              <div class='span2'>
                <div>
                  <%=number_to_currency t.stotal %>
                </div>
                <div class='delivery_price'>
                  (含<%=t.delivery_price || 0 %>运费)
                </div>
              </div>
              <div class='span2'>
                <%=t.state_title %>
              </div>
              <div class='span1'>
                <a href='javascript:void(0)'>详细</a>
              </div>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
    <% end %>
  </div>
</div>


<script type="text/javascript">
  $(function(){
    $(".transaction").each(function(i, elem){
      var card = new TransactionCard({
        el: elem,
        realtime: {
          url: '<%= faye_server_uri %>',
          token: '<%= token %>' }
        });
    });

    new TransactionBubbling({
      url: "http://<%=request.env['HTTP_HOST'] %>/people/<%=current_user.login %>/transactions#order"
    })

    new TransactionsView({ el: "#transactions" });

    $(".direct_transactions>.direct").each(function(i, elem){
      new DirectTransactionView({
        el: $(elem),
        login: "<%=current_user.login %>"
      })
    })
  })
</script>