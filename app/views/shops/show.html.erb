<div id="main" class="content">
  <section class="widget shop_info">
    <div class='photo'>
      <img src="<%=@shop.photos.header %>">
    </div>
    <div class="body">
      <h3 class='page-title'><%= @shop.name %></h3>
      <p>
        <span class='title'>
          关注
        </span>
        <span class='followers'>
          <%=@shop.followers.count %>
        </span>
      </p>
      <p>
        <span class='title'>
          <i class='icon-user'></i>
        </span>
        <span>
          <a href="/people/<%=@shop.user.login %>">
            <%=@shop.user.login %>
          </a>
        </span>
        <% if current_user != @shop.user  %>
          <% if current_user.is_follow_shop?(@shop.id) %>
            <span data-value-id="<%= current_user.follow_shop(@shop.id).id %>" class="label label-success unfollow">取消关注</span>
          <% else %>
            <span class="label label-success follow">+ 关注</span>
          <% end %>
        <% end %>
      </p>
    </div>
  </section>
  <div class='shop_products_panel'>
    <div id="shop_products">
    </div>
    <div class='scroll-load-msg'>
      <img src='/assets/loading_max.gif' />正在加载...
    </div>
  </div>
</div>

<script type="text/template" id="shop_products-preview-template">
  <%= render "shop_products/page" %>
</script>

<script type="text/javascript">
  $(function(){
    new ActivityLayoutView({
      el: '#shop_products'
    })
    new LoadShopProducts({
      search_options: {
        shop_id: <%= @shop.id %>
      },
      el: $('.shop_products_panel')
    })

    new ShopProductPreview({
      el: $("#shop_products")
    })

    new FollowView({
      data: {
        follow_id: <%=@shop.id %>,
        follow_type: "Shop"
      },
      login: "<%=current_user.login %>",
      el: $(".shop_info")
    })
  })
</script>
