<%= stylesheet_link_tag "system/product" %>
<%= semantic_form_for product, :method => :put do |f| %>
  <%= f.inputs "Product" do %>
    <%= f.input :name %>
    <%= f.input :attachments, :as => :aplum, :img_version => "100x100", :collection => product.attachments %>
    <%= f.input :category, :as => :category %>
    <%= f.input :brand_name %>
    <%= f.input :summary %>
    <%= f.input :price, :class => :product_price %>
  <% end %>
  <%= f.inputs "规格/参数", :class => 'inputs additional_properties' do %>
	<%= render_content(@content, locals: { category: @category }) %>
  <% end %>
  <%= f.inputs "描述" do %>
    <%= f.input :description, :as => :text %>
  <% end %>
  <%= f.actions %>
<% end %>


<script>
		function admin_category_selector(el) {
			if (el instanceof jQuery) {
				this.el = el;
			} else {
				this.el = $(el);
			}
			var selector_el = this.el;

			this.el.find('ul').css('display', 'none');
			// this.el.find('a').attr('href', 'javascript: void(0);');

			this.el.find('li').on('mouseenter', function(e) {
				$(this).children('ul').show();
			})

			this.el.find('li').on('mouseleave', function(e) {
				$(this).find('ul').hide();
			})

			this.el.find('ul').on('mouseleave', function(e) {
				$(this).hide();
			})

			this.el.find('a').on('click', function(e) {
				var category_id = $(this).attr('data-id');
				$('input#product_category_id').val(category_id);

				var category_name = $(this).attr('data-name');
				$('input.mock_prodcut_category_id').val(category_name);

				selector_el.children('ul').hide();
				load_category_properties(category_id);

				return false;
			})


			function load_category_properties(category_id) {
				var url = "<%= load_category_properties_system_products_path %>";
				var product_id = <%= product.id || 0 %>;
				var product_param = product_id > 0 ? "product_id=" + product_id : ""
				var category_param = "category_id=" + category_id
				url += '?' + [product_param, category_param].join('&')
				$(".additional_properties ol").load(url, function(data){

				})
			}
		}

		$(function(){
			var el = $("div.category-parent-class");
			admin_category_selector(el);
			$('input.mock_prodcut_category_id').on('click', function(e){
				el.children('ul').show()
			})
		})
</script>
