<div class='community'>
  <%= render :partial => "following" %>
  <div class='row-fluid'>
    <div class='span7'>
      <div class='left'>
        <div class='widget toolbar'>
          <form class='create_topic'>
            <textarea class='span12' name='content' placeholder='分享新鲜事'></textarea>
            <div class='row-fluid attachments-panel hide'>
              <div class="reset_avatar main_panle">
                <div id="image_bottom">
                  <div class="hidden_one" id="hidden_text">
                    <%#= upload_tip %>
                  </div>
                  <div class="update_photo_panle upload_user_avatar file-box">
                  </div>
                </div>
              </div>
              <div class='photo_upload'>
                <ul class='attachment-list topic-attachment'></ul>
              </div>
            </div>

            <div class='row-fluid'>
              <div class='span2 title'>
                分享对象
              </div>
              <div class='span4'>
                <select class='span12' name='category_id'>
                  <% @circle.categories.each do |c| %>
                  <option value="<%=c.id %>">
                    <%=c.name %>
                  </option>
                  <% end %>
                </select>
              </div>
              <div class='span2'>
                <input type='button' value='附加图片' class='btn btn-primary add-attachments' />
              </div>
              <div class='pull-right'>
                <input type='submit' value='分 享' class='btn btn-primary disabled' />
              </div>
            </div>
          </form>
        </div>
        <% unless @circle.is_member?(current_user) %>
        <div data-toggle="tooltip" data-placement="top" title="" data-original-title="请先加入商圈" class='bgtoolbar'></div>
        <% end %>
        <div class='topics'>
        </div>
      </div>
    </div>
    <div class='span5'>
      <div class='right'>
        <%= render :partial => "description" %>
        <div class='topics'>
        </div>
      </div>
    </div>
  </div>
  <div id="load_message_notifiy"></div>
</div>

<script type='text/template' id='create-topic-template'>
  <%= render :partial => "topics/topic" %>
</script>

<script type='text/template' id='create-comment-template'>
  <%= render :partial => "topics/comment" %>
</script>

<script type='text/javascript'>
  $(function(){
    new CircleListView({
      el: $(".community"),
      circle_id: <%=@circle.id %>,
      topic_fetch_url: "<%=topic_fetch_url %>"
    })

    new FollowView({
      data: {
        follow_id:  $(".owner").attr("data-value-id"),
        follow_type: "<%=@circle.owner_type %>"
      },
      login: "<%=current_user.login %>",
      el: $(".owner")
    })

    <%if @circle.is_member?(current_user) %>
    new AttachmentUpload({
      el: $(".attachment-list.topic-attachment"),
      limit: 5,
      default_enabled: false,
      params: {
        version_name: "100x100",
        url_upload: "/attachments",
        input_name: "attachment_ids",
        default_img_url: "<%= default_img_url('100x100') %>",
        template: "<%=j render '/circles/upload_template' %>"
      }
    })
    <% end %>
  })
</script>