<% admin_active_section :pending %>

<div class='row-fluid'>
  <div class='span12'>
    <h3 class='page-title'>未处理</h3>
  </div>
</div>
<div class='row-fluid'>
  <div class='span12'>
    <section class='widget'>
      <table class='table table-striped table-images untransactions'>
        <thead>
          <tr>
            <th>订单编号</th>
            <th>买家</th>
            <th>商品数量</th>
            <th>总金额</th>
            <th>下单日期</th>
            <th>状态</th>
            <th>地址</th>
            <th>操作</th>
          </tr>
        </thead>
        <tbody>
        </tbody>
      </table>
    </section>
  </div>
</div>
<div class='row-fluid'>
  <div class='span12'>
    <h3 class='page-title'>正在处理</h3>
  </div>
</div>
<div class='row-fluid transaction-list'>
  <div class='span12 left'>
    <div class='people-groups'>
    </div>

    <div class='threeD-viewport'>
      <div class='orders card_list'>
        <%= render :partial => "order_mini_row", :collection => @transactions, :as => :row %>
      </div>
    </div>

    <div class='boxes'>
      <div class='upbox'></div>
      <div class='currentbox'></div>
      <div class='downbox'></div>
    </div>
    <%= paginate @transactions %>
  </div>
  <div class='order-detail'></div>
</div>

<script type="text/javascript">
  $(function(){

    var shop = {
      name: "<%= current_shop.name %>",
      id: "<%= current_shop.id %>",
      token: "<%= current_shop.im_token %>"
    }

    new TransactionTwoColumnsViewport({
      el: $(".transaction-list"),
      secondContainer: ".order-detail",
      remote_url: "<%= shop_admins_transactions_path(current_shop) %>",
      leftSide: "#left_sidebar",
      registerView: function(view){
        new ShopTransactionCard({
          el: $(".transaction", view.$detail)
        })
      }
    })

    // var orders = new ShopOrderTransactions({
    //   el: $(".transaction-list"),
    //   remote_url: "<%= shop_admins_transactions_path(current_shop) %>",
    //   shop: shop})

    var dispose_view = new TransactionDispose({
      el: $("table.untransactions"),
      shop: shop,
      tranOpts: {
        transactions: { }
      },
      template: Hogan.compile("<%= j render :partial => 'untransaction' %>")
    })

    dispose_view.add_orders(<%= @untransactions.as_json(:methods => "seller_state_title").to_json.html_safe %>)

    new TransactionBubbling({
      url: "http://<%= request.env['HTTP_HOST'] %>/shops/<%= current_shop.name %>/admins/pending#order"
    })
  })
</script>