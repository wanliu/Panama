<div id="page" >
	<div class="row-fluid">
		<div class="btn-toolbar">
			<div class="btn-group">
				<%= link_to t(:create), "#/new", :class => 'btn', :id => :new_product %>
			</div>
			<div class="btn-group pull-right">
				<form class="form-search span2">
				  <div class="input-append">
				    <input type="text" class=" search-query">
				    <button type="submit" class="btn">Search</button>
				  </div>
				</form>				
			</div>
		</div>
	</div>
	<div class="row-fluid">
		<div class="span3">
			<div class="row-fluid">
				<table id="category_tree" class="table table-bordered table-striped table-hover">
					<thead>
						<tr>
						<th>分类</th>
						</tr>
					</thead>
					<% @categories.each do |category| %>
						<%= render :partial => "mini_category", :object => category %>
					<% end %>
				</table>
			</div>
		</div>
		<div class="span9">
			<div class="row-fluid">
				<%= render_widget :table, :display, @products, nil, 
					:heads => [:name, :price, :amount, :bonus, :util],
					:head_options => { 
						:class => %w(table table-striped table-bordered table-hover)
					},
					:add_column => [ {:util => proc do |row|
						content_tag :div, :class => 'btn-group' do 
							link_to(icon(:edit), "#/#{row[:_id]}/edit", :class => 'btn utils edit') +
							link_to(icon(:remove), "#", :'data-delete-url' => "#{row[:_id]}", :class => 'btn utils delete')
						end
					end }],
					:hide_column => [:_id]
				%>

			</div>
		</div>
	</div>

</div>

<%= register_javascript :products_tools do %>
<script type="text/javascript">
	require(['jquery', 'admins/shops/products', 'models/element_model'], function($, Products, ElementModel){
		var urlRoot = '<%= shop_admins_templates_path %>';
		var $trs = $("#category_tree tr:gt(0)");
		$trs.each(function(i, tr){
			// var models = FormToModel($(tr).find("form"), "category");
			// var model = new Category.Model(models)
			var model = new ElementModel(tr)
			new Products.CategoryMiniRow({el: tr, model: model});
		});

		$("#table tr:gt(0)").each(function(i, tr){
			var row = new Products.ProductRow({el: tr, urlRoot: urlRoot})
		});

		$("#new_product").on("click", function(){
			var row = new Products.ProductRow({urlRoot: urlRoot})
			row.newProduct();
		})
	});
</script>
<% end %>
