<%= simple_form_for form, 
    :url => admins_products(form), 
    :remote => true,
    :html => {
        :class => "form-horizontal"
    } do |f| %>
    <%= f.input :name, :as => :chosen, :url => "http://192.168.2.235:3002/products/search", :remote_key => "title", :remote_value => "id" %> 

    <div class='control-group'>
        <ul class='attachment-list'>            
            <% @attachments.each do | a | %>
                <li>
                    <div class='attachable'>   
                        <%= image_tag a.attachable.url("100x100"), :class => "img-rounded attachable-preview"  %>
                        <input type='hidden' value="<%= a.new_record? ? "" : a.id %>" />
                        <div class="attachment-upload" style='display:none'></div>

                        <div class='focus-panle' style='display:none' status="<%=a.new_record  %>" >
                            <a href='javascript:void(0)' class='delete-img'>删除</a>
                            <a href='javascript:void(0)' class='default-index-img'>设为主图</a>
                        </div>
                    </div>
                </li>
            <% end %>        
        <ul>
    </div>
    
    <%= f.input :price %>
    <%= f.association :category, 
        :collection => current_shop.category.descendants, :as => :chosen %>
    <%= f.input :summary , as: :text %>
    <%= f.button :submit, :save %>

    <%= link_to_if(form.new_record?, :cancel, '#', :class => 'btn cancel') do 
        link_to :close, '#', :class => 'btn close'
    end %>

    <%#= f.association :photos %>
<% end %>


<%= register_javascript :product_form_editor, :only => :ajax do %>
<script type="text/javascript">
    require(['jquery', 'backbone', 'rails.view', 'nested_form'], function($, Backbone, Rails){
        var form = new Rails.FormView("form#<%= options_dom_id(form) %>", {
            model: <%= raw form.to_json %>
        });
    })
</script>
<% end %>

<script type='text/javascript'>
    require(["admins/shops/product_upload"], function(view){        
        new view.ProductUpload({ 
            el : $("form .attachment-list"), 
            shop_id : "<%=current_shop.id %>" ,
            default_img_url : "<%=default_img_url('100x100') %>"
        })
    })
</script>
