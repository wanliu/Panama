<% admin_active_section :direct_transactions %>
<div class='row-fluid direct_transactions'>
  <div class='span12'>
    <div class='widget'>
      <div class='row-fluid'>
        <div class='span7'>
          <div class='span7'>
            商品
          </div>
          <div class='span3'>
            单价
          </div>
          <div class='span2'>
            数量
          </div>
        </div>
       <div class='span2'>
          合计
        </div>
        <div class='span2'>
          状态
        </div>
        <div class='span1'>
          操作
        </div>
      </div>
      <% @direct_transactions.each do |t| %>
      <div class="item" data-value-id="<%=t.id %>">
        <div class='summarize'>
          <div class='row-fluid head'>
            <div class='span3'>
              编号: <%=t.number %>
            </div>
            <div class='span4'>
              在
              <small rel='tooltip' title="<%=I18n.l t.created_at, :format => :long %>">
                <%= time_ago_in_words t.created_at %>
              </small>
              之前成交
            </div>
            <div class='span2'>
              <%= link_to t.seller.name, shop_path(t.seller)  %>
            </div>
          </div>
          <div class='row-fluid products'>
            <div class='span7'>
              <% t.items.each do |item| %>
              <%=render_funcat "product_item", :item => item %>
              <% end %>
            </div>
            <div class='span2'>
              <%=number_to_currency t.total %>
            </div>
            <div class='span2'>
              <%=t.state_title %>
            </div>
            <div class='span1'>
              <% if t.state == :uncomplete %>
              <a href='javascript:void(0)' class='btn_delete'>删除</a>
              <% end %>
            </div>
          </div>
        </div>
        <div class='detail'>
        </div>
      </div>
      <% end %>
    </div>
  </div>
</div>
<%= paginate @direct_transactions %>
<script type="text/javascript">
  $(function(){
    var direct_transaction = function(elem){
      new ShopDirectTransactionView({
        shop: {
          token: "<%=current_shop.im_token %>"
        },
        realtime_url: '<%= faye_server_uri %>',
        token: "<%= token %>",
        el: $(elem)})
    }

    var view = new TableListView({
      el: $(".direct_transactions"),
      remote_url: "<%= shop_admins_direct_transactions_path(current_shop) %>",
      bindView: function(view){
        direct_transaction(view.$(".detail .direct"))
      }
    })
  })
</script>